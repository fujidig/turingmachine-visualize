<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<title>Turing Machine Emuration</title>
<style>
#tape {
    font-size: 200%;
}
</style>
<script src="https://code.jquery.com/jquery-3.1.0.js" integrity="sha256-slogkvB1K3VOkzAI8QITxV3VzpOnkeNVsKvtkYLMjfk=" crossorigin="anonymous"></script>
<script>
var machine_src = [
    "  0        _       _       R       0",
    "  0        1       1       R       1",
    "  1        _       1       R       2",
    "  1        1       1       R       1",
    "  2        _       _       L       3",
    "  2        1       1       R       2",
    "  3        _       _       L       3",
    "  3        1       _       L       4",
    "  4        _       _       R       stop",
    "  4        1       1       L       4",
];


class Machine {
    constructor (map, tuples, statenames) {
        this.map = map;
        this.tuples = tuples;
        this.statenames = statenames;
    }
}

var machine = build_machine(machine_src);
console.log(machine);

function build_machine(src) {
    var map = new Map();
    var tuples = [];
    var statenames = [];
    src.forEach((line) => {
       var m = line.match(/(\S+) +(\S+) +(\S+) +(\S+) +(\S+)/);
       var [q0, s0, s1, a, q1] = m.slice(1);
       map.set(q0+","+s0, [s1, a, q1]);
       tuples.push([q0, s0, s1, a, q1]);
       if (!statenames.includes(q0)) statenames.push(q0);
       if (!statenames.includes(q1)) statenames.push(q1);
    });
    return new Machine(map, tuples, statenames);
}

function run(machine, tapestr, pos, statenodes, edges) {
    var q = "0";
    var tape = tapestr.split("");
    var prevedge = null;
    function step() {
        var s = tape[pos] || "_";
        var tuple = machine.map.get(q+","+s);
        if (prevedge) {
            $("path", prevedge).attr("stroke", "black");
            $("polygon", prevedge).attr("fill", "black").attr("stroke", "black");
        }
        if (!tuple) return;
        var [s1, a, newq] = tuple;
        var newpos = pos;
        if (a == "L") {
            newpos --;
        } else if (a == "R") {
            newpos ++;
        }
        $("path", edges.get(q+","+s)).attr("stroke", "red");
        $("polygon", edges.get(q+","+s)).attr("fill", "red").attr("stroke", "red");
        prevedge = edges.get(q+","+s);
        change_tape_ui(pos, s1, newpos);
        $("ellipse", statenodes.get(q)).attr("fill", "none");
        $("ellipse", statenodes.get(newq)).attr("fill", "yellow");
        tape[pos] = s1;
        pos = newpos;
        q = newq;

    }
    $("ellipse", statenodes.get(q)).attr("fill", "yellow");
    setTimeout(() => {
        setInterval(step, 1000);
    }, 1000);
}

function build_tape_ui(text, pos) {
    var $table = $("<table id='tape'/>");
    var $trs = [$("<tr/>"), $("<tr/>")];
    $trs.forEach(($tr, i) => {
        for (var j = 0; j < 20; j ++) {
            var $td = $("<td/>").attr("id", "tape-"+i+"-"+j);
            if (i == 0) {
                if (j == pos) {
                    $td.html("<span id='cursor' style='font-size:50%'>â–¼</span>");
                }
            } else {
                $td.text(text[j] || "_");
            }
            $tr.append($td);
        }
        $table.append($tr);
    });
    $("body").append($table);
}

function change_tape_ui(pos, symbol, newpos) {
    $("#tape-1-"+pos).text(symbol);
    $("#tape-0-"+newpos).append($("#cursor"));
}

function build_statenodes(machine) {
    var statenodes = new Map();
    var $nodes = $(".node");
    [...$nodes].forEach((node) => {
        var [_, name] = $("title", node).text().match(/_(\w+)/);
        statenodes.set(name, node);
    });
    return statenodes;
}

function build_edges(machine) {
    var edges = new Map();
    var $edges = $(".edge");
    [...$edges].forEach((edge) => {
        var [_, name1, name2] = $("title", edge).text().match(/_(\w+)->_(\w+)/);
        var [symbol] = $("text", edge).text().match(/\S+/);
        edges.set(name1+","+symbol, edge);
    });
    return edges;
}

$(() => {
   var tape = "____111_11";
   var pos = 3;
   var statenodes = build_statenodes(machine);
   var edges = build_edges(machine);
   build_tape_ui(tape, 3);
   run(machine, tape, pos, statenodes, edges);
});
</script>
</head>
<body>
<!-- generated by webgraphviz http://www.webgraphviz.com/ -->
<svg width="662pt" height="79pt" viewBox="0.00 0.00 662.00 78.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph1" class="graph" transform="scale(1 1) rotate(0) translate(4 74.8)">
<title>sample</title>
<polygon fill="white" stroke="white" points="-4,5 -4,-74.8 659,-74.8 659,5 -4,5"></polygon>
<!-- _0 -->
<g id="node1" class="node"><title>_0</title>
<ellipse fill="none" stroke="black" cx="27" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="27" y="-13.8" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- _0&#45;&gt;_0 -->
<g id="edge2" class="edge"><title>_0-&gt;_0</title>
<path fill="none" stroke="black" d="M16.4531,-34.6641C14.1094,-44.625 17.625,-54 27,-54 33.0059,-54 36.607,-50.1525 37.8035,-44.7682"></path>
<polygon fill="black" stroke="black" points="41.2997,-44.5719 37.5469,-34.6641 34.302,-44.7497 41.2997,-44.5719"></polygon>
<text text-anchor="middle" x="27" y="-58.2" font-family="Times,serif" font-size="14.00">_ _ R</text>
</g>
<!-- _1 -->
<g id="node2" class="node"><title>_1</title>
<ellipse fill="none" stroke="black" cx="147" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="147" y="-13.8" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- _0&#45;&gt;_1 -->
<g id="edge4" class="edge"><title>_0-&gt;_1</title>
<path fill="none" stroke="black" d="M54.188,-18C70.5345,-18 91.808,-18 109.761,-18"></path>
<polygon fill="black" stroke="black" points="109.885,-21.5001 119.885,-18 109.885,-14.5001 109.885,-21.5001"></polygon>
<text text-anchor="middle" x="87" y="-22.2" font-family="Times,serif" font-size="14.00">1 1 R</text>
</g>
<!-- _1&#45;&gt;_1 -->
<g id="edge8" class="edge"><title>_1-&gt;_1</title>
<path fill="none" stroke="black" d="M136.453,-34.6641C134.109,-44.625 137.625,-54 147,-54 153.006,-54 156.607,-50.1525 157.804,-44.7682"></path>
<polygon fill="black" stroke="black" points="161.3,-44.5719 157.547,-34.6641 154.302,-44.7497 161.3,-44.5719"></polygon>
<text text-anchor="middle" x="147" y="-58.2" font-family="Times,serif" font-size="14.00">1 1 R</text>
</g>
<!-- _2 -->
<g id="node3" class="node"><title>_2</title>
<ellipse fill="none" stroke="black" cx="267" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="267" y="-13.8" font-family="Times,serif" font-size="14.00">2</text>
</g>
<!-- _1&#45;&gt;_2 -->
<g id="edge6" class="edge"><title>_1-&gt;_2</title>
<path fill="none" stroke="black" d="M174.188,-18C190.534,-18 211.808,-18 229.761,-18"></path>
<polygon fill="black" stroke="black" points="229.885,-21.5001 239.885,-18 229.885,-14.5001 229.885,-21.5001"></polygon>
<text text-anchor="middle" x="207" y="-22.2" font-family="Times,serif" font-size="14.00">_ 1 R</text>
</g>
<!-- _2&#45;&gt;_2 -->
<g id="edge12" class="edge"><title>_2-&gt;_2</title>
<path fill="none" stroke="black" d="M256.453,-34.6641C254.109,-44.625 257.625,-54 267,-54 273.006,-54 276.607,-50.1525 277.804,-44.7682"></path>
<polygon fill="black" stroke="black" points="281.3,-44.5719 277.547,-34.6641 274.302,-44.7497 281.3,-44.5719"></polygon>
<text text-anchor="middle" x="267" y="-58.2" font-family="Times,serif" font-size="14.00">1 1 R</text>
</g>
<!-- _3 -->
<g id="node4" class="node"><title>_3</title>
<ellipse fill="none" stroke="black" cx="387" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="387" y="-13.8" font-family="Times,serif" font-size="14.00">3</text>
</g>
<!-- _2&#45;&gt;_3 -->
<g id="edge10" class="edge"><title>_2-&gt;_3</title>
<path fill="none" stroke="black" d="M294.188,-18C310.534,-18 331.808,-18 349.761,-18"></path>
<polygon fill="black" stroke="black" points="349.885,-21.5001 359.885,-18 349.885,-14.5001 349.885,-21.5001"></polygon>
<text text-anchor="middle" x="327" y="-22.2" font-family="Times,serif" font-size="14.00">_ _ L</text>
</g>
<!-- _3&#45;&gt;_3 -->
<g id="edge14" class="edge"><title>_3-&gt;_3</title>
<path fill="none" stroke="black" d="M376.453,-34.6641C374.109,-44.625 377.625,-54 387,-54 393.006,-54 396.607,-50.1525 397.804,-44.7682"></path>
<polygon fill="black" stroke="black" points="401.3,-44.5719 397.547,-34.6641 394.302,-44.7497 401.3,-44.5719"></polygon>
<text text-anchor="middle" x="387" y="-58.2" font-family="Times,serif" font-size="14.00">_ _ L</text>
</g>
<!-- _4 -->
<g id="node5" class="node"><title>_4</title>
<ellipse fill="none" stroke="black" cx="507" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="507" y="-13.8" font-family="Times,serif" font-size="14.00">4</text>
</g>
<!-- _3&#45;&gt;_4 -->
<g id="edge16" class="edge"><title>_3-&gt;_4</title>
<path fill="none" stroke="black" d="M414.188,-18C430.534,-18 451.808,-18 469.761,-18"></path>
<polygon fill="black" stroke="black" points="469.885,-21.5001 479.885,-18 469.885,-14.5001 469.885,-21.5001"></polygon>
<text text-anchor="middle" x="447" y="-22.2" font-family="Times,serif" font-size="14.00">1 _ L</text>
</g>
<!-- _4&#45;&gt;_4 -->
<g id="edge20" class="edge"><title>_4-&gt;_4</title>
<path fill="none" stroke="black" d="M496.453,-34.6641C494.109,-44.625 497.625,-54 507,-54 513.006,-54 516.607,-50.1525 517.804,-44.7682"></path>
<polygon fill="black" stroke="black" points="521.3,-44.5719 517.547,-34.6641 514.302,-44.7497 521.3,-44.5719"></polygon>
<text text-anchor="middle" x="507" y="-58.2" font-family="Times,serif" font-size="14.00">1 1 L</text>
</g>
<!-- _stop -->
<g id="node6" class="node"><title>_stop</title>
<ellipse fill="none" stroke="black" cx="627" cy="-18" rx="27.2661" ry="18"></ellipse>
<text text-anchor="middle" x="627" y="-13.8" font-family="Times,serif" font-size="14.00">stop</text>
</g>
<!-- _4&#45;&gt;_stop -->
<g id="edge18" class="edge"><title>_4-&gt;_stop</title>
<path fill="none" stroke="black" d="M534.188,-18C550.421,-18 571.513,-18 589.386,-18"></path>
<polygon fill="black" stroke="black" points="589.477,-21.5001 599.477,-18 589.477,-14.5001 589.477,-21.5001"></polygon>
<text text-anchor="middle" x="567" y="-22.2" font-family="Times,serif" font-size="14.00">_ _ R</text>
</g>
</g>
</svg>
</body>
</html>